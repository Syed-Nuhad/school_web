{% extends "base.html" %}
{% load static %}
{% load humanize %}
{% block title %}Home · College Management System{% endblock %}

{% block head %}
<style>
  form > div { margin-bottom: 10px; }
  label { display: inline-block; width: 120px; font-weight: bold; }
  input, select { width: 200px; padding: 5px; }
  button { padding: 8px 16px; margin-top: 10px; }
  #marksheet { border: 1px solid #ccc; padding: 15px; margin-top: 20px; display: none; }
  #marksheet h3 { margin-top: 0; }
  table { width: 100%; border-collapse: collapse; margin-top: 10px; }
  th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
  th { background-color: #f4f4f4; }
</style>
{% endblock %}

{% block content %}
<section class="hero-banner">
  <div id="heroCarousel"
       class="carousel carousel-light slide"
       data-bs-ride="carousel"
       data-bs-interval="5000"
       style="display:block;visibility:visible;">
    <div class="carousel-inner" style="display:block;">

      {% for b in banners %}
        <div class="carousel-item {% if forloop.first %}active{% endif %}"
             style="height:clamp(360px,52vw,560px);position:relative;">
          {% if b.image_src %}
            <img src="{{ b.image_src }}"
                 alt="{{ b.title|default:'Banner' }}"
                 class="d-block w-100"
                 style="width:100%;height:100%;object-fit:cover;">
          {% endif %}

          <!-- Dark overlay -->
          <div style="
               position:absolute;inset:0;
               background:rgba(0,0,0,.55);
               z-index:1;"></div>

          <!-- Centered caption -->
          <div class="carousel-caption p-0"
               style="
                 position:absolute;inset:0;
                 display:flex;align-items:center;justify-content:center;
                 text-align:center;background:none;z-index:2;">
            <div class="px-3">
              {% if b.title %}
                <h2 class="mb-2 text-white"
                    style="font-weight:800;
                           font-size:clamp(1.9rem,3.6vw + 1rem,3.6rem);
                           letter-spacing:.2px;">
                  {{ b.title }}
                </h2>
              {% endif %}
              {% if b.subtitle %}
                <p class="mb-3"
                   style="font-size:clamp(1.05rem,1.2vw + .6rem,1.5rem);opacity:.98;">
                  {{ b.subtitle }}
                </p>
              {% endif %}
              {% if b.button_text and b.button_link %}
                <a class="btn btn-primary btn-lg"
                   href="{{ b.button_link }}"
                   style="padding:.6rem 1.25rem;font-weight:600;">
                  {{ b.button_text }}
                </a>
              {% endif %}
            </div>
          </div>
        </div>
      {% empty %}
        <div class="carousel-item active"
             style="height:clamp(360px,52vw,560px);position:relative;">
          <div class="d-block w-100 bg-light" style="width:100%;height:100%;"></div>
          <div style="position:absolute;inset:0;background:rgba(0,0,0,.55);"></div>
        </div>
      {% endfor %}

    </div>

    <!-- Controls -->
    <button class="carousel-control-prev" type="button" data-bs-target="#heroCarousel" data-bs-slide="prev" aria-label="Previous">
      <span class="carousel-control-prev-icon" aria-hidden="true"></span>
    </button>
    <button class="carousel-control-next" type="button" data-bs-target="#heroCarousel" data-bs-slide="next" aria-label="Next">
      <span class="carousel-control-next-icon" aria-hidden="true"></span>
    </button>

    <!-- Dots (indicators) -->
    <div class="carousel-indicators" style="bottom:12px;">
      {% for _ in banners %}
        <button type="button"
                data-bs-target="#heroCarousel"
                data-bs-slide-to="{{ forloop.counter0 }}"
                {% if forloop.first %}class="active" aria-current="true"{% endif %}
                aria-label="Slide {{ forloop.counter }}"
                style="width:12px;height:12px;border-radius:50%;
                       background-color:rgba(255,255,255,.8);">
        </button>
      {% endfor %}
    </div>
  </div>
</section>

<!-- ⭐⭐⭐⭐⭐======================== Start  Notice Board -->
<section class="container py-5" id="notice">
  <div class="d-flex align-items-center justify-content-between pb-4">
    <h1 class="fw-normal mb-0">Notices</h1>
    <a href="{% url 'notices_list' %}" class="btn btn-sm btn-outline-primary">View all</a>
  </div>

  {% if notices %}
    <div class="row g-3">
      {# show ONLY the latest 4, even if the view passed more #}
      {% for n in notices|slice:":4" %}
        <div class="col-12 col-sm-6 col-lg-3">
          <article class="h-100 border rounded-3 overflow-hidden bg-white">
            {% if n.image_src %}
              <a class="ratio ratio-16x9 d-block" href="{% url 'notice_detail' n.pk %}" aria-label="Open notice">
                <div class="w-100 h-100"
                     style="background-image:url('{{ n.image_src|escape }}');
                            background-size:cover;background-position:center;"></div>
              </a>
            {% else %}
              <a class="ratio ratio-16x9 d-block bg-light text-decoration-none"
                 href="{% url 'notice_detail' n.pk %}" aria-label="Open notice">
                <div class="w-100 h-100 d-flex align-items-center justify-content-center text-muted">
                  No image
                </div>
              </a>
            {% endif %}

            <div class="p-3">
              <h3 class="h6 mb-2 text-primary">{{ n.title }}</h3>
              {% if n.subtitle %}
                <p class="text-muted small mb-3">{{ n.subtitle|truncatechars:120 }}</p>
              {% endif %}

              <div class="d-flex justify-content-between align-items-center">
                <small class="text-muted">Published: {{ n.published_at|date:"M j, Y" }}</small>
                <a href="{% url 'notice_detail' n.pk %}" class="btn btn-sm btn-outline-primary">Read</a>
              </div>
            </div>
          </article>
        </div>
      {% endfor %}
    </div>
  {% else %}
    <div class="text-center text-muted">No notices yet.</div>
  {% endif %}
</section>
<!-- ⭐ End: Notice Board -->
<!-- ⭐ End: Notice Board -->
<!-- ✅ Modern Timeline (Bootstrap + inline styles only) -->
<section class="py-5" id="academic-timeline">
  <div class="container" style="max-width:1100px;">
    <div class="text-start mb-4">
      <h1 class="fw-normal mb-1">Timeline</h1>
      <p class="text-muted mb-0">All the key dates at a glance</p>
    </div>

    {% for e in timeline_events %}
      <!-- keep the whole row narrow on xl to avoid “centered” feel -->
      <div class="row gx-4 gy-3 align-items-start mb-4">
        <div class="col-12 col-xl-10">

          <div class="row gx-4 gy-3 align-items-start">
            <!-- date: auto width, left-aligned -->
            <div class="col-12 col-md-auto text-start">
              <span class="badge rounded-pill text-bg-info fw-semibold">
                {{ e.date|date:"M j, Y" }}
              </span>
            </div>

            <!-- content: takes the rest, but capped using cols -->
            <div class="col-12 col-md-9 col-lg-8 position-relative border-start border-2 border-info">

              <!-- dot on rail -->
              <span class="position-absolute d-none d-md-inline-block rounded-circle bg-info"
                    style="left:-7px; top:14px; width:14px; height:14px; box-shadow:0 0 0 6px rgba(13,202,240,.18);"></span>
              <span class="position-absolute d-inline-block d-md-none rounded-circle bg-info"
                    style="left:-6px; top:10px; width:12px; height:12px; box-shadow:0 0 0 5px rgba(13,202,240,.18);"></span>

              <div class="bg-white shadow-sm rounded-3 p-3 p-md-4 border border-light-subtle">
                <h5 class="mb-1 fw-bold">{{ e.title }}</h5>
                {% if e.description %}
                  <p class="mb-0 text-muted">{{ e.description }}</p>
                {% endif %}
              </div>
            </div>
          </div>

        </div>
      </div>
    {% empty %}
      <div class="text-start text-muted">No upcoming items yet.</div>
    {% endfor %}
  </div>
</section>
<!--END-->


{% load static %}

<section id="glx-gallery" class="container py-5">
  <div class="mb-4">
    <h1 class="fw-normal mb-1">Campus Gallery</h1>
    <p class="text-muted mb-0">Photos &amp; videos from campus life</p>
  </div>

  <!-- more breathing room on big screens -->
  <div class="row g-4 g-lg-5">
    {% for item in gallery_items %}
      <!-- Bigger cards on large screens: 2-up on lg, 3-up on very wide (xxl) -->
      <div class="col-12 col-sm-6 col-lg-6 col-xxl-4">
        <!-- Keep .glx-card and data-* for your JS -->
        <a href="#"
           role="button"
           class="glx-card d-block text-decoration-none border bg-body rounded-4 shadow-sm p-3 h-100"
           data-kind="{{ item.kind }}"
           data-image="{% if item.image %}{{ item.image.url }}{% endif %}"
           data-video="{{ item.youtube_embed_url }}"
           data-title="{{ item.title|escape }}"
           data-place="{{ item.place|default_if_none:''|escape }}"
           data-datetime="{% if item.taken_at %}{{ item.taken_at|date:'M j, Y, g:i A' }}{% endif %}">

          <!-- Big thumbnail, cropped nicely, no custom CSS -->
          <div class="glx-thumb ratio rounded-4 overflow-hidden mb-3 position-relative">
            <img
              src="{% if item.thumbnail %}{{ item.thumbnail.url }}{% elif item.image %}{{ item.image.url }}{% else %}{% static 'img/placeholder-16x9.jpg' %}{% endif %}"
              alt="{{ item.title }}"
              class="w-100 h-100"
              style="object-fit:cover"
              loading="lazy">
            {% if item.kind == 'video' %}
              <span class="glx-play" aria-hidden="true">▶</span>
            {% endif %}
          </div>

          <!-- Clean caption -->
          <div class="d-flex flex-column gap-1">
            <div class="fw-semibold fs-5 text-body text-truncate">{{ item.title }}</div>
            <div class="text-secondary small text-truncate">
              {% if item.place %}{{ item.place }}{% endif %}
              {% if item.taken_at %}{% if item.place %} · {% endif %}{{ item.taken_at|date:'M j, Y, g:i A' }}{% endif %}
            </div>
          </div>
        </a>
      </div>
    {% empty %}
      <div class="col-12 text-muted">No gallery items yet.</div>
    {% endfor %}
  </div>
</section>
<!-- WhatsApp-style fullscreen viewer -->
<div class="modal fade" id="glxModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-fullscreen">
    <div class="modal-content bg-black border-0">
      <div class="modal-body p-0 position-relative">

        <!-- Top bar (overlay) -->
        <div class="position-absolute top-0 start-0 end-0 p-2 d-flex align-items-center" style="z-index:2;">
          <div class="text-white">
            <div id="glxTitle" class="fw-semibold"></div>
            <small id="glxMeta" class="text-white-50"></small>
          </div>
          <div class="ms-auto d-flex align-items-center gap-2">
            <!-- Shown for images only -->
            <button id="glxZoomOut" type="button" class="btn btn-sm btn-outline-light d-none" title="Zoom out">−</button>
            <button id="glxZoomIn"  type="button" class="btn btn-sm btn-outline-light d-none" title="Zoom in">+</button>
            <button id="glxReset"   type="button" class="btn btn-sm btn-outline-light d-none" title="Reset">Reset</button>
            <a id="glxDownload" class="btn btn-sm btn-primary d-none" download>Download</a>
            <!-- Close -->
            <button type="button" class="btn-close btn-close-white ms-1" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
        </div>

        <!-- IMAGE viewport (fills screen) -->
        <div id="glxImageWrap"
             class="d-none w-100 vh-100 overflow-hidden d-flex align-items-center justify-content-center"
             style="cursor:grab; touch-action:none; background:#000;">
          <img id="glxImage" alt="" draggable="false" class="user-select-none"
               style="will-change:transform; transform:translate(0px,0px) scale(1); max-width:none; max-height:none;">
        </div>

        <!-- VIDEO viewport -->
        <div id="glxVideoWrap" class="d-none w-100 vh-100 d-flex align-items-center justify-content-center bg-black">
          <div class="ratio ratio-16x9 w-100" style="max-width:1000px;">
            <iframe id="glxIframe" title="Video"
              allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
              allowfullscreen referrerpolicy="strict-origin-when-cross-origin"></iframe>
          </div>
        </div>

      </div>
    </div>
  </div>
</div>

<!--About section-->
{% if about %}
<section class="container py-5" id="about" data-aos="fade-up">
  <div class="text-start fw-normal mb-1">
    <h1 class="fw-normal">{{ about.title }}</h1>
  </div>

  <div class="row align-items-center">
    <div class="col-md-6 mb-4 mb-md-0">
      <div class="image-fade-container rounded shadow" style="height:350px; overflow:hidden; position:relative;">
        {% for url, alt in about.image_list %}
          <img src="{{ url }}" alt="{{ alt|default:about.title }}" class="fade-image {% if forloop.first %}active{% endif %}" loading="lazy" style="object-fit:cover;">
        {% endfor %}
      </div>
    </div>

    <div class="col-md-6 fade-in delay-2">
      {% if about.college_name %}<h2 class="text-primary fw-normal mb-3">{{ about.college_name }}</h2>{% endif %}
      {% if about.body %}<p class="lead text-muted">{{ about.body }}</p>{% endif %}
      {% if about.bullet_list %}
        <ul class="list-unstyled mt-3">
          {% for b in about.bullet_list %}<li>✅ {{ b }}</li>{% endfor %}
        </ul>
      {% endif %}
    </div>
  </div>
</section>
{% endif %}

<!--END-->
<section class="container py-5 academic-calendar-section" data-aos="fade-up">
  <h2 class="text-start fw-normal mb-4">Academic Calendar</h2>

  <div class="row g-4">
    {% for item in calendar_items %}
      <div class="col-md-4">
        <div class="shadow rounded p-4 h-100 text-center calendar-card">
          <div class="calendar-icon {{ item.icon_tone_class }}">
            <i class="{{ item.icon_class }} text-white" aria-hidden="true"></i>
          </div>
          <h5 class="fw-normal mb-1">{{ item.title }}</h5>
          <p class="text-muted mb-2">{{ item.date_text }}</p>
          {% if item.description %}
            <p class="mb-3">{{ item.description }}</p>
          {% endif %}
          <div class="small text-secondary">
            {% if item.created_by %}
              Created by {{ item.created_by.get_full_name|default:item.created_by.username }} ·
            {% endif %}
            {{ item.created_at|date:"M j, Y, g:i A" }}
          </div>
        </div>
      </div>
    {% empty %}
      <div class="col-12 text-center text-muted">No academic calendar items yet.</div>
    {% endfor %}
  </div>
</section>



<!-- ⭐⭐⭐⭐⭐ ===============Start [ACADEMIC SECTION] Courses & Programs -->

<section id="academics" class="py-5">
  <div class="container" data-aos="fade-up">
    <div class="text-center mb-4">
      <h2 class="fw-normal">Programs & Courses</h2>
      <p class="text-muted">Explore our programs — durations, eligibility, fees and downloadable syllabi.</p>
    </div>

    <div class="d-flex justify-content-center mb-4 flex-wrap gap-2">
      <button class="btn btn-outline-primary btn-sm filter-btn active" data-filter="all">All</button>
      <button class="btn btn-outline-primary btn-sm filter-btn" data-filter="science">Science</button>
      <button class="btn btn-outline-primary btn-sm filter-btn" data-filter="commerce">Commerce</button>
      <button class="btn btn-outline-primary btn-sm filter-btn" data-filter="arts">Arts</button>
      <button class="btn btn-outline-primary btn-sm filter-btn" data-filter="vocational">Vocational</button>
    </div>

    <div class="row g-4" id="courses-grid">
      {% for course in courses %}
        <div class="col-12 col-md-6 col-lg-4 course-card" data-category="{{ course.category|lower }}">
          <div class="card h-100 shadow-sm border-0">
            {% if course.image %}
              <img src="{{ course.image.url }}" class="card-img-top" alt="{{ course.title }}">
            {% else %}
              <img src="{% static 'img/default_course.jpg' %}" class="card-img-top" alt="{{ course.title }}">
            {% endif %}
            <div class="card-body d-flex flex-column">
              <h5 class="card-title">{{ course.title }}</h5>

              {% if course.duration or course.shift %}
                <p class="text-muted small mb-2">
                  {% if course.duration %}Duration: {{ course.duration }}{% endif %}
                  {% if course.shift %}{% if course.duration %} • {% endif %}Shift: {{ course.shift }}{% endif %}
                </p>
              {% endif %}

              {% if course.description %}
                <p class="card-text mb-3">{{ course.description }}</p>
              {% endif %}

              <ul class="list-unstyled mb-3 small">
                {% if course.eligibility %}
                  <li><strong>Eligibility:</strong> {{ course.eligibility }}</li>
                {% endif %}
                {% if course.monthly_fee %}
                  <li><strong>Monthly Fee:</strong> BDT {{ course.monthly_fee|intcomma }}</li>
                {% endif %}
              </ul>

          <div class="mt-auto d-flex gap-2">
            {% if course.syllabus_file %}
              <a
                href="{{ course.syllabus_file.url }}"
                class="btn btn-outline-primary btn-sm js-open-syllabus"
                data-img="{{ course.syllabus_file.url }}"
                data-title="{{ course.title|escape }}"
              >
                View Syllabus
              </a>
            {% else %}
              <button class="btn btn-outline-secondary btn-sm" disabled>View Syllabus</button>
            {% endif %}

            <a href="{% url 'admissions:apply' %}?course={{ course.id }}" class="btn btn-primary btn-sm ms-auto">
              Apply Now
            </a>
          </div>

            </div>

            <div class="card-footer bg-transparent border-0 pt-0 small text-muted d-flex justify-content-between">
              {% if course.created_by %}<span>By {{ course.created_by.get_username }}</span>{% else %}<span>&nbsp;</span>{% endif %}
              <span>Updated {{ course.updated_at|date:"M j, Y" }}</span>
            </div>
          </div>
        </div>
      {% empty %}
        <div class="col-12 text-center text-muted">No courses yet. Add some in the admin.</div>
      {% endfor %}
    </div>
  </div>
</section>



<!-- Syllabus Viewer Modal -->
<div class="modal fade" id="syllabusModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-fullscreen-lg-down modal-xl">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Syllabus Viewer</h5>
        <a id="syllabusDownload" class="btn btn-success btn-sm d-none" download>Download</a>
        <button type="button" class="btn-close ms-2" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>

      <div class="modal-body p-0" style="height:80vh;">
        <!-- We load the full PDF.js viewer in an iframe -->
        <iframe id="syllabusFrame"
                title="Syllabus"
                style="border:0;width:100%;height:100%;"
                referrerpolicy="strict-origin-when-cross-origin"
                allow="fullscreen">
        </iframe>
      </div>
    </div>
  </div>
</div>
<!--⭐ End ====[ACADEMIC SECTION] -->

<!-- ⭐⭐⭐⭐⭐ Start : College Function Highlights -->
<section class="container my-5" id="college-functions">
  <h2 class="fw-normal">College Function Highlights</h2>

  <div id="functions-gallery" class="row g-5 align-items-center">
    {% for f in functions_page %}
      <div class="col-md-6 {% if forloop.counter|divisibleby:2 %}order-md-2{% endif %}"
           data-aos="fade-{{ forloop.counter|divisibleby:2|yesno:'left,right' }}">
        <div class="media-box position-relative shadow rounded overflow-hidden">
          {% if f.image %}
            <a href="{{ f.image.url }}"
               class="js-fn-item d-block"
               data-sub-html="<h4 class='mb-0'>{{ f.title|escape }}</h4>">
              <img src="{{ f.image.url }}" alt="{{ f.title }}"
                   class="img-fluid w-100 function-img"
                   style="height:300px;object-fit:cover;">
            </a>
          {% else %}
            <div class="bg-light p-5 text-center">No image</div>
          {% endif %}

          <div class="media-overlay position-absolute top-0 start-0 w-100 h-100 d-flex flex-column justify-content-between p-3 text-white bg-dark bg-opacity-50">
            <h4 class="mb-0">{{ f.title }}</h4>
            {% if f.image %}
              <a href="{{ f.image.url }}"
                 class="btn btn-primary align-self-end mt-2 js-fn-item"
                 data-sub-html="<h4 class='mb-0'>{{ f.title|escape }}</h4>">
                Full View
              </a>
            {% endif %}
          </div>
        </div>

        <div class="bg-light p-3 rounded shadow-sm mt-3">
          {% if f.place %}<p class="mb-1"><strong>Place:</strong> {{ f.place }}</p>{% endif %}
          {% if f.date_text %}<p class="mb-1"><strong>Date:</strong> {{ f.date_text }}</p>{% endif %}
          {% if f.time_text %}<p class="mb-0"><strong>Time:</strong> {{ f.time_text }}</p>{% endif %}
        </div>
      </div>

      <div class="col-md-6 {% if forloop.counter|divisibleby:2 %}order-md-1{% endif %}"
           data-aos="fade-{{ forloop.counter|divisibleby:2|yesno:'right,left' }}">
        <div class="function-description p-4 shadow rounded bg-light h-100">
          <p class="mb-0">{{ f.description }}</p>
        </div>
      </div>
    {% empty %}
      <div class="col-12">
        <div class="alert alert-info">No function highlights yet.</div>
      </div>
    {% endfor %}
  </div>

  {# --- Bootstrap-default pager (no spacing classes) --- #}
  {% if functions_page.paginator.num_pages > 1 %}
    <nav aria-label="Function pagination" class="mt-4 text-align-center align-items-center justify-content-center">
      <ul class="pagination text-align-center align-items-center justify-content-center">
        {% if functions_page.has_previous %}
          <li class="page-item">
            <a class="page-link" href="?fpage={{ functions_page.previous_page_number }}#college-functions">Previous</a>
          </li>
        {% else %}
          <li class="page-item disabled"><span class="page-link">Previous</span></li>
        {% endif %}

        {% for p in functions_page.paginator.page_range %}
          {% if p == functions_page.number %}
            <li class="page-item active" aria-current="page">
              <a class="page-link" href="?fpage={{ p }}#college-functions">{{ p }}</a>
            </li>
          {% else %}
            <li class="page-item">
              <a class="page-link" href="?fpage={{ p }}#college-functions">{{ p }}</a>
            </li>
          {% endif %}
        {% endfor %}

        {% if functions_page.has_next %}
          <li class="page-item">
            <a class="page-link" href="?fpage={{ functions_page.next_page_number }}#college-functions">Next</a>
          </li>
        {% else %}
          <li class="page-item disabled"><span class="page-link">Next</span></li>
        {% endif %}
      </ul>
    </nav>
  {% endif %}
</section>

<!-- ⭐ End  College Function Highlights -->



{# === Modal with close icon & back button === #}
<!-- WhatsApp-like Image Viewer -->
<div class="modal fade" id="functionImageModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-fullscreen-md-down modal-xl">
    <div class="modal-content bg-black text-white">

      <!-- Header: title left | actions right -->
      <div class="modal-header py-2 px-3 border-0">
        <div class="fw-semibold" id="fimTitle">Full View</div>
        <div class="d-flex align-items-center gap-2">
          <!-- download -->
          <a id="fimDownload" class="btn btn-sm btn-outline-light" href="#" download title="Download">
            <i class="bi bi-download"></i>
          </a>
          <!-- zoom - / + -->
          <button id="fimZoomOut" class="btn btn-sm btn-outline-light" type="button" title="Zoom out">
            <i class="bi bi-zoom-out"></i>
          </button>
          <button id="fimZoomIn" class="btn btn-sm btn-outline-light" type="button" title="Zoom in">
            <i class="bi bi-zoom-in"></i>
          </button>
          <!-- close -->
          <button type="button" class="btn btn-sm btn-light ms-1" data-bs-dismiss="modal" aria-label="Close">
            <i class="bi bi-x-lg"></i>
          </button>
        </div>
      </div>

      <!-- Body: centered image, pan/zoom -->
      <div class="modal-body p-0 d-flex justify-content-center align-items-center" style="min-height:70vh;">
        <div id="fimViewport" class="w-100 h-100 d-flex justify-content-center align-items-center overflow-hidden" style="background:#0f0f0f;">
          <img id="fimImg" src="" alt="" style="max-width:none; max-height:none; user-select:none; -webkit-user-drag:none; cursor:grab;">
        </div>
      </div>

    </div>
  </div>
</div>


<!-- ⭐⭐⭐⭐⭐ Start: College Festivals -->
<section class="container my-5" id="college-festivals">
  <h2 class="text-start fw-normal mb-5" data-aos="fade-up">College Festivals</h2>

  {% if festivals_page.object_list %}
    {% for fest in festivals_page %}
      {% with is_even=forloop.counter|divisibleby:2 %}
      <div class="row g-5 align-items-center mb-5" data-fest-box="{{ fest.id }}">
        <!-- Media side -->
        <div class="col-md-6 {% if is_even %}order-md-2{% endif %}"
             data-aos="fade-{% if is_even %}left{% else %}right{% endif %}">
          <div class="position-relative shadow rounded overflow-hidden">

            {# HERO: video wins > youtube > image #}
            {% if fest.hero_video %}
              <a href="#" class="d-block js-play-hero" data-video="{{ fest.hero_video.url }}" aria-label="Play video">
                {% if fest.hero_image %}
                  <img src="{{ fest.hero_image.url }}" class="img-fluid w-100" style="height:300px;object-fit:cover;" alt="{{ fest.title }}">
                {% else %}
                  <div class="bg-dark d-flex align-items-center justify-content-center text-white" style="height:300px">Play Video</div>
                {% endif %}
              </a>
            {% elif fest.hero_youtube_url %}
              <a href="#" class="d-block js-open-lg" data-fest="{{ fest.id }}" data-kind="youtube" data-src="{{ fest.hero_youtube_url }}" data-index="0">
                {% if fest.hero_image %}
                  <img src="{{ fest.hero_image.url }}" class="img-fluid w-100" style="height:300px;object-fit:cover;" alt="{{ fest.title }}">
                {% else %}
                  <div class="bg-dark d-flex align-items-center justify-content-center text-white" style="height:300px">Watch on YouTube</div>
                {% endif %}
              </a>
            {% elif fest.hero_image %}
              <a href="#" class="d-block js-open-lg" data-fest="{{ fest.id }}" data-kind="image" data-src="{{ fest.hero_image.url }}" data-index="0">
                <img src="{{ fest.hero_image.url }}" class="img-fluid w-100" style="height:300px;object-fit:cover;" alt="{{ fest.title }}">
              </a>
            {% else %}
              <div class="bg-light p-5 text-center">No media</div>
            {% endif %}

            <div class="position-absolute top-0 start-0 w-100 h-100 d-flex flex-column justify-content-between p-3 text-white bg-dark bg-opacity-50">
              <h4 class="mb-0">{{ fest.title }}</h4>
              <div class="align-self-end d-flex gap-2">
                {% if fest.hero_video %}
                  <a href="#" class="btn btn-primary btn-sm js-play-hero" data-video="{{ fest.hero_video.url }}">Play</a>
                {% endif %}
                {% if fest.hero_image or fest.hero_youtube_url %}
                  <a href="#" class="btn btn-outline-light btn-sm js-open-lg" data-fest="{{ fest.id }}" data-index="0">Full View</a>
                {% endif %}
              </div>
            </div>
          </div>

          <div class="bg-light p-3 rounded shadow-sm mt-3">
            {% if fest.place %}<p class="mb-1"><strong>Place:</strong> {{ fest.place }}</p>{% endif %}
            {% if fest.date_text %}<p class="mb-1"><strong>Date:</strong> {{ fest.date_text }}</p>{% endif %}
            {% if fest.time_text %}<p class="mb-0"><strong>Time:</strong> {{ fest.time_text }}</p>{% endif %}
          </div>
        </div>

        <!-- Text + thumbs -->
        <div class="col-md-6 {% if is_even %}order-md-1{% endif %}"
             data-aos="fade-{% if is_even %}right{% else %}left{% endif %}">
          <div class="p-4 shadow rounded bg-light h-100">
            <p class="mb-0">{{ fest.description }}</p>

            {% if fest.media_items.all %}
              <div class="row g-2 mt-3">
                {% for m in fest.media_items.all %}
                  {% if m.is_active %}
                    <div class="col-4">
                      {% if m.kind == 'image' and m.image %}
                        <a href="#" class="d-block js-open-lg"
                           data-fest="{{ fest.id }}" data-kind="image"
                           data-src="{{ m.image.url }}" data-index="{{ forloop.counter0 }}">
                          <img src="{{ m.thumbnail.url|default:m.image.url }}" class="img-fluid rounded" alt="{{ m.caption }}">
                        </a>
                      {% elif m.kind == 'youtube' and m.youtube_url %}
                        <a href="#" class="d-block js-open-lg"
                           data-fest="{{ fest.id }}" data-kind="youtube"
                           data-src="{{ m.youtube_url }}" data-index="{{ forloop.counter0 }}">
                          {% if m.thumbnail %}
                            <img src="{{ m.thumbnail.url }}" class="img-fluid rounded" alt="{{ m.caption }}">
                          {% else %}
                            <div class="ratio ratio-16x9 rounded bg-dark text-white d-flex align-items-center justify-content-center">
                              YT
                            </div>
                          {% endif %}
                        </a>
                      {% endif %}
                    </div>
                  {% endif %}
                {% endfor %}
              </div>
            {% endif %}
          </div>
        </div>
      </div>
      {% endwith %}
    {% endfor %}

    {# --- PAGER --- #}
    {% if festivals_page.paginator.num_pages > 1 %}
      <nav aria-label="Festivals pagination" class="mt-4">
        <ul class="pagination text-align-center align-items-center justify-content-center">
          {% if festivals_page.has_previous %}
            <li class="page-item">
              <a class="page-link" href="?festpage={{ festivals_page.previous_page_number }}#college-festivals">Previous</a>
            </li>
          {% else %}
            <li class="page-item disabled"><span class="page-link">Previous</span></li>
          {% endif %}

          {% for p in festivals_page.paginator.page_range %}
            {% if p == festivals_page.number %}
              <li class="page-item active" aria-current="page">
                <a class="page-link" href="?festpage={{ p }}#college-festivals">{{ p }}</a>
              </li>
            {% else %}
              <li class="page-item">
                <a class="page-link" href="?festpage={{ p }}#college-festivals">{{ p }}</a>
              </li>
            {% endif %}
          {% endfor %}

          {% if festivals_page.has_next %}
            <li class="page-item">
              <a class="page-link" href="?festpage={{ festivals_page.next_page_number }}#college-festivals">Next</a>
            </li>
          {% else %}
            <li class="page-item disabled"><span class="page-link">Next</span></li>
          {% endif %}
        </ul>
      </nav>
    {% endif %}
  {% else %}
    <div class="alert alert-info">No festivals yet.</div>
  {% endif %}
</section>
<!-- ⭐ End: College Festivals -->

<!-- Bootstrap Video Modal (for hero MP4) -->
<div class="modal fade" id="festVideoModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-xl">
    <div class="modal-content bg-dark border-0">
      <button type="button" class="btn-close btn-close-white position-absolute end-0 m-2" data-bs-dismiss="modal" aria-label="Close"></button>
      <div class="modal-body p-0">
        <video id="festVideoPlayer" class="w-100" controls playsinline></video>
      </div>
    </div>
  </div>
</div>



<!-- ⭐⭐⭐⭐⭐====================== Start: College Member Dashboard Section ====================== -->
<section class="container py-5" id="college-members" data-aos="fade-up">
  <h2 class="text-start mb-4 fw-normal">College Members</h2>

  <div class="row g-4">
    <!-- HOD -->
    <div class="col-md-3">
      <div class="card dashboard-card text-center p-3 shadow-sm">
        <div class="card-icon mb-2 fs-1">👨‍💼</div>
        <h5 class="card-title">Head of Department</h5>
        <div class="small text-muted mb-2">{{ members_counts.hod|default_if_none:"0" }} total</div>
        <div class="card-buttons mt-2">
          <button class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#membersModalHod">
            View All
          </button>
        </div>
      </div>
    </div>

    <!-- Teachers -->
    <div class="col-md-3">
      <div class="card dashboard-card text-center p-3 shadow-sm">
        <div class="card-icon mb-2 fs-1">👩‍🏫</div>
        <h5 class="card-title">Teachers</h5>
        <div class="small text-muted mb-2">{{ members_counts.teacher|default_if_none:"0" }} total</div>
        <div class="card-buttons mt-2">
          <button class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#membersModalTeacher">
            View All
          </button>
        </div>
      </div>
    </div>

    <!-- Students -->
    <div class="col-md-3">
      <div class="card dashboard-card text-center p-3 shadow-sm">
        <div class="card-icon mb-2 fs-1">👨‍🎓</div>
        <h5 class="card-title">Students</h5>
        <div class="small text-muted mb-2">{{ members_counts.student|default_if_none:"0" }} total</div>
        <div class="card-buttons mt-2">
          <button class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#membersModalStudent">
            View All
          </button>
        </div>
      </div>
    </div>

    <!-- Staff -->
    <div class="col-md-3">
      <div class="card dashboard-card text-center p-3 shadow-sm">
        <div class="card-icon mb-2 fs-1">🧑‍🔧</div>
        <h5 class="card-title">Staff</h5>
        <div class="small text-muted mb-2">{{ members_counts.staff|default_if_none:"0" }} total</div>
        <div class="card-buttons mt-2">
          <button class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#membersModalStaff">
            View All
          </button>
        </div>
      </div>
    </div>
  </div>
</section>

{# Modals — ids use {{ sec.key|title }} → Hod / Teacher / Student / Staff #}
{% for sec in member_sections %}
  <div class="modal fade" id="membersModal{{ sec.key|title }}" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">{{ sec.label }}</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="row g-3">
            {% if sec.items %}
              {% for m in sec.items %}
                <div class="col-md-6">
                  <div class="d-flex align-items-center gap-3 border rounded p-2">
                    {% if m.photo %}
                      <img src="{{ m.photo.url }}" alt="{{ m.name }}" class="rounded" style="width:64px;height:64px;object-fit:cover;">
                    {% elif m.photo_url %}
                      <img src="{{ m.photo_url }}" alt="{{ m.name }}" class="rounded" style="width:64px;height:64px;object-fit:cover;">
                    {% endif %}
                    <div>
                      <div class="fw-semibold">{{ m.name }}</div>
                      {% if m.post %}<div class="small text-muted">{{ m.post }}</div>{% endif %}
                      {% if m.section %}<div class="small text-muted">Section: {{ m.section }}</div>{% endif %}
                    </div>
                  </div>
                </div>
              {% endfor %}
            {% else %}
              <div class="col-12">
                <div class="text-muted small">No entries yet.</div>
              </div>
            {% endif %}
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-light" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>
{% endfor %}
<!-- ⭐ End: College Member Dashboard Section ================================================== -->

{# ✅ Four reusable modals (Bootstrap) — NO .split() calls #}
{% for sec in member_sections %}
  {# id uses TitleCase so: hod -> Hod, teacher -> Teacher, etc. #}
  <div class="modal fade" id="membersModal{{ sec.key|title }}" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">{{ sec.label }}</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>

        <div class="modal-body">
          <div class="row g-3">
            {% if sec.items %}
              {% for m in sec.items %}
                <div class="col-md-6">
                  <div class="d-flex align-items-center gap-3 border rounded p-2">
                    {% if m.photo %}
                      <img src="{{ m.photo.url }}" alt="{{ m.name }}" class="rounded"
                           style="width:64px;height:64px;object-fit:cover;">
                    {% endif %}
                    <div>
                      <div class="fw-semibold">{{ m.name }}</div>
                      {% if m.post %}<div class="small text-muted">{{ m.post }}</div>{% endif %}
                      {% if m.section %}<div class="small text-muted">Section: {{ m.section }}</div>{% endif %}
                    </div>
                  </div>
                </div>
              {% endfor %}
            {% else %}
              <div class="col-12">
                <div class="text-muted small">No entries yet.</div>
              </div>
            {% endif %}
          </div>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-light" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>
{% endfor %}
<!-- ⭐ End: College Member Dashboard Section ================================================== -->




<!-- ⭐⭐⭐⭐⭐======================= Start: Contact Section ======================= -->
<section id="contact" class="py-5">
  <div class="container" data-aos="fade-up">
    <!-- Django flash messages (success/error) near the form anchor -->
    {% if messages %}
      <div class="mb-3">
        {% for message in messages %}
          <div class="alert alert-{{ message.tags|default:'info' }} mb-2" role="alert">
            {{ message }}
          </div>
        {% endfor %}
      </div>
    {% endif %}

    <div class="text-center mb-4">
      <h2 class="fw-normal">Contact Us</h2>
      <p class="text-muted">We’d love to hear from you! Reach out using the form or visit us directly.</p>
    </div>

    <div class="row g-4">
      <!-- Left: Contact info from admin -->
      <div class="col-lg-4">
        <div class="card shadow-sm border-0 h-100">
          <div class="card-body">
            <h5 class="fw-normal mb-3">Get in Touch</h5>

            {% if contact_info and contact_info.address %}
              <p class="mb-2">
                <i class="bi bi-geo-alt-fill text-primary me-2"></i>
                {{ contact_info.address }}
              </p>
            {% endif %}

            {% if contact_info and contact_info.phone %}
              <p class="mb-2">
                <i class="bi bi-telephone-fill text-primary me-2"></i>
                <a href="tel:{{ contact_info.phone|cut:' ' }}" class="text-decoration-none">
                  {{ contact_info.phone }}
                </a>
              </p>
            {% endif %}

            {% if contact_info and contact_info.email %}
              <p class="mb-2">
                <i class="bi bi-envelope-fill text-primary me-2"></i>
                <a href="mailto:{{ contact_info.email }}" class="text-decoration-none">
                  {{ contact_info.email }}
                </a>
              </p>
            {% endif %}

            {% if contact_info and contact_info.hours %}
              <p class="mb-0">
                <i class="bi bi-clock-fill text-primary me-2"></i>
                {{ contact_info.hours }}
              </p>
            {% endif %}
          </div>
        </div>
      </div>

      <!-- Right: Contact form (Django form fields) -->
      <div class="col-lg-8">
        <div class="card shadow-sm border-0">
          <div class="card-body">
            <form id="contact-form" method="post" action="{% url 'contact_submit' %}#contact" novalidate>
              {% csrf_token %}

              <div class="row g-3">
                <div class="col-md-6">
                  <label class="form-label small text-muted mb-1">Your Name</label>
                  {{ contact_form.name }}
                  {% if contact_form.name.errors %}
                    <div class="text-danger small mt-1">{{ contact_form.name.errors|striptags }}</div>
                  {% endif %}
                </div>

                <div class="col-md-6">
                  <label class="form-label small text-muted mb-1">Your Email</label>
                  {{ contact_form.email }}
                  {% if contact_form.email.errors %}
                    <div class="text-danger small mt-1">{{ contact_form.email.errors|striptags }}</div>
                  {% endif %}
                </div>

                <div class="col-md-12">
                  <label class="form-label small text-muted mb-1">Subject</label>
                  {{ contact_form.subject }}
                  {% if contact_form.subject.errors %}
                    <div class="text-danger small mt-1">{{ contact_form.subject.errors|striptags }}</div>
                  {% endif %}
                </div>

                <div class="col-md-12">
                  <label class="form-label small text-muted mb-1">Your Message</label>
                  {{ contact_form.message }}
                  {% if contact_form.message.errors %}
                    <div class="text-danger small mt-1">{{ contact_form.message.errors|striptags }}</div>
                  {% endif %}
                </div>

                <div class="col-md-6">
                  <label class="form-label small text-muted mb-1">Phone (optional)</label>
                  {{ contact_form.phone }}
                  {% if contact_form.phone.errors %}
                    <div class="text-danger small mt-1">{{ contact_form.phone.errors|striptags }}</div>
                  {% endif %}
                </div>

                <!-- Honeypot (hidden) -->
                <div class="d-none">
                  {{ contact_form.website }}
                </div>

                <!-- Non-field errors -->
                {% if contact_form.non_field_errors %}
                  <div class="col-12">
                    <div class="text-danger small">{{ contact_form.non_field_errors|striptags }}</div>
                  </div>
                {% endif %}

                <div class="col-12 text-end">
                  <button type="submit" class="btn btn-primary px-4">Send Message</button>
                </div>
              </div>
            </form>
          </div>
        </div>
      </div>

      <!-- Map (admin-managed embed URL) -->
      <div class="col-12">
        <div class="map-container shadow-sm">
          {% if contact_info and contact_info.map_embed_src %}
            <iframe
              src="{{ contact_info.map_embed_src }}"
              width="100%" height="350" style="border:0;" allowfullscreen="" loading="lazy"
              referrerpolicy="no-referrer-when-downgrade">
            </iframe>
          {% else %}
            <div class="alert alert-light border text-muted mb-0">
              Map not configured yet. Add an <strong>Embed URL</strong> in Admin → Contact Info.
            </div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</section>
<!-- ⭐ End: Contact Section =================================================== -->


{% endblock %}
