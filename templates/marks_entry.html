<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Marks Entry</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
  <link href="./css/cms.css" rel="stylesheet"/>
  <style>
    body, html {
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #f0f4f8, #e9ecef);
    }
    .sticky-header {
      position: sticky;
      top: 0;
      z-index: 1020;
      background-color: #ffffffdd;
      backdrop-filter: blur(10px);
      border-bottom: 1px solid #ddd;
      padding: 0.5rem 1rem;
      display: flex;
      align-items: center;
      gap: 0.8rem;
    }
    .sticky-header img { height: 45px; border-radius: 6px; }
    .sticky-header h4 { margin: 0; font-weight: 700; color: #0d6efd; font-size: 1.4rem; }
    .card-soft { background: #ffffffcc; border-radius: 12px; padding: 1.5rem; box-shadow: 0 6px 20px rgba(0,0,0,0.08); margin-bottom: 1.5rem; }
    .table thead { background-color: #0d6efd; color: white; }
    .fade-row { opacity: 0; transform: translateY(15px); animation: fadeIn 0.45s forwards; }
    @keyframes fadeIn { to { opacity: 1; transform: translateY(0); } }
    .back-home { display: flex; justify-content: center; margin: 2rem 0; }
    .back-home button { background: linear-gradient(45deg,#0d6efd,#6610f2); color: #fff; padding: 0.7rem 1.8rem; border-radius: 50px; border: none; font-weight: 600; font-size: 1rem; box-shadow: 0 4px 15px rgba(0,0,0,0.2); transition: all 0.3s; }
    .back-home button:hover { transform: scale(1.05); box-shadow: 0 6px 25px rgba(0,0,0,0.3); }
    .gpa { font-weight: 600; }
    .gpa.low { color: #dc3545; }
    .gpa.mid { color: #ffc107; }
    .gpa.high { color: #198754; }
  </style>
</head>
<body class="section">

<div class="sticky-header">
  <img src="./img/logo/DS-Logo.png" alt="College Logo">
  <h4>üìù Marks Entry</h4>
</div>

<section class="container py-5">

  <div class="card-soft">
    <div class="row g-3 mb-3">
      <div class="col-md-3">
        <label class="form-label">Exam</label>
        <input type="text" class="form-control" id="examName" placeholder="Mid Term">
      </div>
      <div class="col-md-3">
        <label class="form-label">Class</label>
        <select class="form-select" id="mClass">
          <option selected>Class 6</option>
          <option>Class 7</option>
          <option>Class 8</option>
          <option>Class 9</option>
          <option>Class 10</option>
        </select>
      </div>
      <div class="col-md-3">
        <label class="form-label">Section</label>
        <select class="form-select" id="mSection">
          <option selected>A</option>
          <option>B</option>
          <option>C</option>
        </select>
      </div>
      <div class="col-md-3 d-flex align-items-end">
        <button class="btn btn-primary w-100" onclick="loadMarks()">Load</button>
      </div>
    </div>

    <!-- Search Bar -->
    <div class="mb-3">
      <input type="text" class="form-control" id="searchStudent" placeholder="üîç Search by Name or Roll">
    </div>
  </div>

  <div class="card-soft">
    <div class="table-responsive">
      <table class="table table-striped table-hover align-middle" id="marksTable">
        <thead>
          <tr>
            <th>#</th>
            <th>Name</th>
            <th>Roll</th>
            <th>Bangla</th>
            <th>English</th>
            <th>Math</th>
            <th>Science</th>
            <th>GPA</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
    <div class="d-flex justify-content-end mt-3">
      <button class="btn btn-success" onclick="saveMarks()">Save</button>
    </div>
  </div>

  <div class="back-home">
    <button onclick="window.location.href='index.html'"><i class="bi bi-house-door me-2"></i>Back to Home</button>
  </div>
</section>

<script>
const demoStudents = [
  {name:'Alice Johnson', roll:1},{name:'Brian Smith', roll:2},{name:'Clara Lee', roll:3},{name:'David Kim', roll:4},
  {name:'Eva Brown', roll:5},{name:'Frank Wilson', roll:6},{name:'Grace Chen', roll:7},{name:'Henry Liu', roll:8},
  {name:'Isla Davis', roll:9},{name:'Jack Martin', roll:10}
];

let currentStudents = [...demoStudents];

function rowHTML(i, s) {
  return `
    <tr class="fade-row" style="animation-delay:${i*0.05}s">
      <td>${i+1}</td>
      <td>${s.name}</td>
      <td>${s.roll}</td>
      <td><input class="form-control form-control-sm score" type="number" min="0" max="100" value="0"></td>
      <td><input class="form-control form-control-sm score" type="number" min="0" max="100" value="0"></td>
      <td><input class="form-control form-control-sm score" type="number" min="0" max="100" value="0"></td>
      <td><input class="form-control form-control-sm score" type="number" min="0" max="100" value="0"></td>
      <td class="gpa">0.00</td>
    </tr>`;
}

function computeGPA(scores) {
  const avg = scores.reduce((a,b)=>a+b,0)/scores.length;
  let gpa = Math.max(0, Math.min(5, avg/20));
  return gpa.toFixed(2);
}

function renderTable(students) {
  const tbody = document.querySelector('#marksTable tbody');
  tbody.innerHTML = students.map((s,i)=>rowHTML(i,s)).join('');

  tbody.addEventListener('input', e=>{
    if(!e.target.classList.contains('score')) return;
    let val = Number(e.target.value); if(!Number.isFinite(val)||val<0) val=0; if(val>100) val=100; e.target.value=val;
    const tr = e.target.closest('tr');
    const scores = [...tr.querySelectorAll('.score')].map(inp=>Number(inp.value||0));
    const gpaEl = tr.querySelector('.gpa');
    const gpaVal = computeGPA(scores);
    gpaEl.textContent = gpaVal;
    gpaEl.className='gpa '+(gpaVal<2?'low':gpaVal<3.5?'mid':'high');
  });
}

function loadMarks() {
  currentStudents = [...demoStudents];
  renderTable(currentStudents);
}

// Search functionality
document.getElementById('searchStudent').addEventListener('input', e=>{
  const q = e.target.value.toLowerCase();
  const filtered = currentStudents.filter(s=>s.name.toLowerCase().includes(q) || s.roll.toString() === q);
  renderTable(filtered);
});

function saveMarks() {
  const rows = [...document.querySelectorAll('#marksTable tbody tr')].map(tr=>{
    const tds = [...tr.children];
    const scores = [...tr.querySelectorAll('.score')].map(inp=>Number(inp.value||0));
    return { name: tds[1].innerText, roll: tds[2].innerText, subjects:{Bangla:scores[0],English:scores[1],Math:scores[2],Science:scores[3]}, gpa: tr.querySelector('.gpa').innerText };
  });
  console.log('Saving (stub):', rows);
  alert('‚úÖ Marks saved locally (stub). Replace with API later.');
}
</script>

</body>
</html>
